---
layout: post
title: Distributed Dependency Resolution
---

>The Problem statement

We have 'n' resources R1,R2,R3....Rn which can be any of 'k' type RT1,RT2,RT3...RTk which arrives as a stream of events. The stream of events are the CRUD operation on these resources. Each of these events are idempotent and self contained. They carry all the information needed to get processsed. Lets say we have a dependency template that says the dependency relation among the resourcetypes as shown below.

![Image1]({{ site.url }}/assets/DDR/ddr1.png)

Example:

Let say we have a set of resources R1,R2,R3,R4,R5,R6,R11. 

{% highlight text %}
R1 = RT1
R11 = RT1 
R2 = RT2 
R3 = RT3 
R4 = RT4 
R5 = RT5 
R6 = RT6
{% endhighlight %}

Dependency graph is as shown below for R1.

![Image1]({{ site.url }}/assets/DDR/ddr2.png)

Dependency graph is as shown below for R2.

![Image1]({{ site.url }}/assets/DDR/ddr3.png)

<b>Constraints</b>

<p>

The resources can arrive in anyorder of any type.
The same resource can arrive one after the other in the queue.
When a resource of type RTk arrives and if it is insert/update, it can complete many graphs.
When a resource of type RTk arrives and if it is delete, it can incomplete many graphs.
The underlying processing nodes should be scalable up/down.
The processing Nodes can go down any time.
The processing nodes should be stateless.

</p>

Note that the processing nodes are all running and pulling events from the queue parallelly.

> Story

Lets build the problem statement in a more granular level. Lets assume that the event processing nodes pull the events, transform them and persist the transformed resource into some persistence. The assumption is that each of the node is aware of the dependency template that is as shown above.


> <b>Building the Solution</b>

Just to brief out the solution, when a node receives the resource, In addition to transforming the resource, it also generates other events which is handled by another cluster of nodes(dependency trackernodes).Lets detail out these events.

There are three main events that help in DDR.
DATA_DEPENDENCY, DATA_TRIGGER and DEPENDENCY_RESOLUTION

<b>DATA_DEPENDENCY Event</b>
This event carries information of the dependency a particular resource has. For example. If R1 refers R2, Then the DATA_DEPENDENCY event carries dependant resource R1 and dependsOn R2.
eg: {dependant:R1,dependsOn:R2}


<b>DATA_TRIGGER Event</b>
This event carries the data trigger information which includes the details of the data.
eg:If R2 arrives the processing node sends a DATA_TRIGGER as below
{data:R2}

The question is who handles these (DATA_DEPENDENCY and DATA_TRIGGER) events.<br>

There is another cluster of nodes lets call it dependency trackernodes.When DATA_DEPENDENCY arrives it creates some sort of data structure to store the dependants and dependsOn data.
<br>
Now when DATA_TRIGGER arrives the trackernode determines all those dependants and notifies the Processing Cluster with DEPENDENCY_RESOLUTION for each dependants.

<b>DEPENDENCY_RESOLUTION</b>
This event carries the information of the data dependants whose dependency got resolved.

Enough of the theory.Lets take an example.






